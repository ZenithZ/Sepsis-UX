/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { EventEmitter, Input } from '@angular/core';
/** @type {?} */
var NODES = {
    "ig-text-editor": "div",
    "ig-numeric-editor": "input",
    "ig-percent-editor": "input",
    "ig-mask-editor": "input",
    "ig-date-picker": "input",
    "ig-time-picker": "input",
    "ig-date-editor": "input",
    "ig-currency-editor": "input",
    "ig-checkbox-editor": "input",
    "ig-html-editor": "div",
    "ig-combo": "input",
    "ig-grid": "table",
    "ig-tree-grid": "table",
    "ig-hierarchical-grid": "table",
    "ig-pivot-data-selector": "div",
    "ig-pivot-grid": "table",
    "ig-data-chart": "div",
    "ig-pie-chart": "div",
    "ig-doughnut-chart": "div",
    "ig-funnel-chart": "div",
    "ig-radial-gauge": "div",
    "ig-sparkline": "div",
    "ig-zoombar": "div",
    "ig-map": "div",
    "ig-bullet-graph": "div",
    "ig-linear-gauge": "div",
    "ig-q-r-code-barcode": "div",
    "ig-validator": "div",
    "ig-upload": "div",
    "ig-popover": "div",
    "ig-rating": "div",
    "ig-video-player": "div",
    "ig-radial-menu": "div",
    "ig-split-button": "div",
    "ig-notifier": "div",
    "ig-tree": "div",
    "ig-dialog": "div",
    "ig-splitter": "div",
    "ig-layout-manager": "div",
    "ig-tile-manager": "div",
    "ig-spreadsheet": "div",
    "ig-scheduler": "div"
};
/**
 * @template Model
 */
export class IgControlBase {
    /**
     * @param {?} el
     * @param {?} renderer
     * @param {?} differs
     * @param {?} kvalDiffers
     * @param {?} cdr
     */
    constructor(el, renderer, differs, kvalDiffers, cdr) {
        this.kvalDiffers = kvalDiffers;
        this.cdr = cdr;
        this.options = {};
        this._evtEmmiters = {};
        this._differs = differs;
        this._nativeElement = el.nativeElement;
        this._widgetName = this.convertToCamelCase(el.nativeElement.nodeName.toLowerCase()); //ig-grid -> igGrid
        this._el = el.nativeElement.appendChild(document.createElement(NODES[el.nativeElement.nodeName.toLowerCase()]));
        for (var propt in jQuery.ui[this._widgetName].prototype.events) {
            this[propt] = new EventEmitter();
            //cahcing the event emmitters for cases when the event name is the same as a method name.
            this._evtEmmiters[propt] = this[propt];
        }
    }
    /**
     * @param {?} name
     * @return {?}
     */
    createSetter(name) {
        return (/**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this.options[name] = value;
            if (this._config) {
                this._config[name] = value;
            }
            if (jQuery.ui[this._widgetName] &&
                jQuery.ui[this._widgetName].prototype.options &&
                jQuery.ui[this._widgetName].prototype.options.hasOwnProperty(name) &&
                jQuery(this._el).data(this._widgetName)) {
                jQuery(this._el)[this._widgetName]("option", name, value);
            }
        });
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        /** @type {?} */
        var evtName;
        /** @type {?} */
        let that = this;
        this._events = new Map();
        for (var opt in jQuery.ui[this._widgetName].prototype.options) {
            //copy root level options into this.options
            if (this[opt] && typeof this[opt] !== "function") {
                this.options[opt] = this[opt];
            }
        }
        for (var opt in jQuery.ui[this._widgetName].prototype.options) {
            if (opt !== "dataSource") {
                Object.defineProperty(this, opt, {
                    set: this.createSetter(opt),
                    enumerable: true,
                    configurable: true
                });
            }
        }
        /** @type {?} */
        var propNames = jQuery.ui[this._widgetName].prototype;
        for (var name in propNames) {
            if (name.indexOf("_") !== 0 && typeof jQuery.ui[this._widgetName].prototype[name] === "function"
                && name !== "dataSource") {
                Object.defineProperty(that, name, {
                    get: that.createMethodGetter(name)
                });
            }
        }
        //events binding
        for (var propt in jQuery.ui[this._widgetName].prototype.events) {
            evtName = this._widgetName.toLowerCase() + propt.toLowerCase();
            this._events[evtName] = propt;
            jQuery(this._el).on(evtName, (/**
             * @param {?} evt
             * @param {?} ui
             * @return {?}
             */
            function (evt, ui) {
                /** @type {?} */
                var emmiter = that._evtEmmiters[that._events[evt.type]];
                emmiter.emit({ event: evt, ui: ui });
            }));
        }
        jQuery(this._el).attr("id", this.widgetId);
        jQuery(this._el)[this._widgetName](this.options);
    }
    /**
     * @param {?} name
     * @return {?}
     */
    createMethodGetter(name) {
        return (/**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var widget = jQuery(this._el).data(this._widgetName);
            return jQuery.proxy(widget[name], widget);
        });
    }
    /**
     * @return {?}
     */
    ngDoCheck() {
        if (this._optsDiffer) {
            /** @type {?} */
            const changes = this._optsDiffer.diff(this.options);
            if (changes) {
                changes.forEachChangedItem((/**
                 * @param {?} change
                 * @return {?}
                 */
                (change) => {
                    this[change.key] = change.currentValue;
                }));
            }
        }
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        /** @type {?} */
        const opts = "options";
        if (opts in changes) {
            /** @type {?} */
            const value = changes[opts].currentValue;
            //options have been changed. Destroy and re-create widget.
            if (jQuery(this._el).data(this._widgetName)) {
                jQuery(this._el)[this._widgetName]("destroy");
                jQuery(this._el)[this._widgetName](this.options);
            }
            try {
                this._optsDiffer = this.kvalDiffers.find({}).create();
            }
            catch (e) {
                throw new Error("Only binding to object is supported for options property.");
            }
        }
    }
    /**
     * @return {?}
     */
    markForCheck() {
        this.cdr.markForCheck();
    }
    /**
     * @param {?} str
     * @return {?}
     */
    convertToCamelCase(str) {
        //convert hyphen to camelCase
        return str.replace(/-([a-z])/g, (/**
         * @param {?} group
         * @return {?}
         */
        function (group) {
            return group[1].toUpperCase();
        }));
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        // igZoombar should be attached to body when being destroyed
        if (this._widgetName !== "igZoombar" || document.body.contains(this._el)) {
            jQuery(this._el)[this._widgetName]("destroy");
            jQuery(this._el).remove();
            jQuery(this._nativeElement).remove();
        }
    }
}
IgControlBase.propDecorators = {
    options: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    IgControlBase.prototype.options;
    /**
     * @type {?}
     * @protected
     */
    IgControlBase.prototype._differs;
    /**
     * @type {?}
     * @protected
     */
    IgControlBase.prototype._el;
    /**
     * @type {?}
     * @protected
     */
    IgControlBase.prototype._widgetName;
    /**
     * @type {?}
     * @protected
     */
    IgControlBase.prototype._differ;
    /**
     * @type {?}
     * @protected
     */
    IgControlBase.prototype._optsDiffer;
    /**
     * @type {?}
     * @protected
     */
    IgControlBase.prototype._kvalDiffers;
    /**
     * @type {?}
     * @protected
     */
    IgControlBase.prototype._events;
    /**
     * @type {?}
     * @private
     */
    IgControlBase.prototype._evtEmmiters;
    /**
     * @type {?}
     * @private
     */
    IgControlBase.prototype._nativeElement;
    /** @type {?} */
    IgControlBase.prototype.widgetId;
    /** @type {?} */
    IgControlBase.prototype.kvalDiffers;
    /** @type {?} */
    IgControlBase.prototype.cdr;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaWdjb250cm9sYmFzZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2lnbml0ZXVpLWFuZ3VsYXItd3JhcHBlcnMvIiwic291cmNlcyI6WyJsaWIvaWdjb250cm9sYmFzZS9pZ2NvbnRyb2xiYXNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQWMsWUFBWSxFQUFxRCxLQUFLLEVBQXNDLE1BQU0sZUFBZSxDQUFDOztJQUluSixLQUFLLEdBQUc7SUFDUixnQkFBZ0IsRUFBRSxLQUFLO0lBQ3ZCLG1CQUFtQixFQUFFLE9BQU87SUFDNUIsbUJBQW1CLEVBQUUsT0FBTztJQUM1QixnQkFBZ0IsRUFBRSxPQUFPO0lBQ3pCLGdCQUFnQixFQUFFLE9BQU87SUFDekIsZ0JBQWdCLEVBQUUsT0FBTztJQUN6QixnQkFBZ0IsRUFBRSxPQUFPO0lBQ3pCLG9CQUFvQixFQUFFLE9BQU87SUFDN0Isb0JBQW9CLEVBQUUsT0FBTztJQUM3QixnQkFBZ0IsRUFBRSxLQUFLO0lBQ3ZCLFVBQVUsRUFBRSxPQUFPO0lBQ25CLFNBQVMsRUFBRSxPQUFPO0lBQ2xCLGNBQWMsRUFBRSxPQUFPO0lBQ3ZCLHNCQUFzQixFQUFFLE9BQU87SUFDL0Isd0JBQXdCLEVBQUUsS0FBSztJQUMvQixlQUFlLEVBQUUsT0FBTztJQUN4QixlQUFlLEVBQUUsS0FBSztJQUN0QixjQUFjLEVBQUUsS0FBSztJQUNyQixtQkFBbUIsRUFBRSxLQUFLO0lBQzFCLGlCQUFpQixFQUFFLEtBQUs7SUFDeEIsaUJBQWlCLEVBQUUsS0FBSztJQUN4QixjQUFjLEVBQUUsS0FBSztJQUNyQixZQUFZLEVBQUUsS0FBSztJQUNuQixRQUFRLEVBQUUsS0FBSztJQUNmLGlCQUFpQixFQUFFLEtBQUs7SUFDeEIsaUJBQWlCLEVBQUUsS0FBSztJQUN4QixxQkFBcUIsRUFBRSxLQUFLO0lBQzVCLGNBQWMsRUFBRSxLQUFLO0lBQ3JCLFdBQVcsRUFBRSxLQUFLO0lBQ2xCLFlBQVksRUFBRSxLQUFLO0lBQ25CLFdBQVcsRUFBRSxLQUFLO0lBQ2xCLGlCQUFpQixFQUFFLEtBQUs7SUFDeEIsZ0JBQWdCLEVBQUUsS0FBSztJQUN2QixpQkFBaUIsRUFBRSxLQUFLO0lBQ3hCLGFBQWEsRUFBRSxLQUFLO0lBQ3BCLFNBQVMsRUFBRSxLQUFLO0lBQ2hCLFdBQVcsRUFBRSxLQUFLO0lBQ2xCLGFBQWEsRUFBRSxLQUFLO0lBQ3BCLG1CQUFtQixFQUFFLEtBQUs7SUFDMUIsaUJBQWlCLEVBQUUsS0FBSztJQUN4QixnQkFBZ0IsRUFBRSxLQUFLO0lBQ3ZCLGNBQWMsRUFBRSxLQUFLO0NBQ3hCOzs7O0FBRUQsTUFBTSxPQUFPLGFBQWE7Ozs7Ozs7O0lBZXRCLFlBQVksRUFBYyxFQUFFLFFBQWtCLEVBQUUsT0FBd0IsRUFBUyxXQUE0QixFQUFTLEdBQXNCO1FBQTNELGdCQUFXLEdBQVgsV0FBVyxDQUFpQjtRQUFTLFFBQUcsR0FBSCxHQUFHLENBQW1CO1FBYnJJLFlBQU8sR0FBUSxFQUFFLENBQUM7UUFTakIsaUJBQVksR0FBUSxFQUFFLENBQUM7UUFLM0IsSUFBSSxDQUFDLFFBQVEsR0FBRyxPQUFPLENBQUM7UUFDeEIsSUFBSSxDQUFDLGNBQWMsR0FBRyxFQUFFLENBQUMsYUFBYSxDQUFDO1FBQ3ZDLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLGtCQUFrQixDQUFDLEVBQUUsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLFdBQVcsRUFBRSxDQUFDLENBQUMsQ0FBQSxtQkFBbUI7UUFDdkcsSUFBSSxDQUFDLEdBQUcsR0FBRyxFQUFFLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUVoSCxLQUFLLElBQUksS0FBSyxJQUFJLE1BQU0sQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxNQUFNLEVBQUU7WUFDNUQsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7WUFDakMseUZBQXlGO1lBQ3pGLElBQUksQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1NBQzFDO0lBQ0wsQ0FBQzs7Ozs7SUFFRCxZQUFZLENBQUMsSUFBSTtRQUNiOzs7O1FBQU8sVUFBVSxLQUFLO1lBQ2xCLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEdBQUcsS0FBSyxDQUFDO1lBQzNCLElBQUksSUFBSSxDQUFDLE9BQU8sRUFBRTtnQkFDZCxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxHQUFHLEtBQUssQ0FBQzthQUM5QjtZQUNELElBQUksTUFBTSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDO2dCQUMzQixNQUFNLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxTQUFTLENBQUMsT0FBTztnQkFDN0MsTUFBTSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDO2dCQUNsRSxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLEVBQUU7Z0JBQ3pDLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDLFFBQVEsRUFBRSxJQUFJLEVBQUUsS0FBSyxDQUFDLENBQUM7YUFDN0Q7UUFDTCxDQUFDLEVBQUE7SUFDTCxDQUFDOzs7O0lBRUQsUUFBUTs7WUFDQSxPQUFPOztZQUNQLElBQUksR0FBRyxJQUFJO1FBQ2YsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLEdBQUcsRUFBa0IsQ0FBQztRQUV6QyxLQUFLLElBQUksR0FBRyxJQUFJLE1BQU0sQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxPQUFPLEVBQUU7WUFDM0QsMkNBQTJDO1lBQzNDLElBQUksSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLFVBQVUsRUFBRTtnQkFDOUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7YUFDakM7U0FDSjtRQUVELEtBQUssSUFBSSxHQUFHLElBQUksTUFBTSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsU0FBUyxDQUFDLE9BQU8sRUFBRTtZQUMzRCxJQUFJLEdBQUcsS0FBSyxZQUFZLEVBQUU7Z0JBQ3RCLE1BQU0sQ0FBQyxjQUFjLENBQUMsSUFBSSxFQUFFLEdBQUcsRUFBRTtvQkFDN0IsR0FBRyxFQUFFLElBQUksQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDO29CQUMzQixVQUFVLEVBQUUsSUFBSTtvQkFDaEIsWUFBWSxFQUFFLElBQUk7aUJBQ3JCLENBQUMsQ0FBQzthQUNOO1NBQ0o7O1lBRUcsU0FBUyxHQUFHLE1BQU0sQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDLFNBQVM7UUFDckQsS0FBSyxJQUFJLElBQUksSUFBSSxTQUFTLEVBQUU7WUFDeEIsSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsSUFBSSxPQUFPLE1BQU0sQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsS0FBSyxVQUFVO21CQUN6RixJQUFJLEtBQUssWUFBWSxFQUFFO2dCQUMxQixNQUFNLENBQUMsY0FBYyxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUU7b0JBQzlCLEdBQUcsRUFBRSxJQUFJLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDO2lCQUNyQyxDQUFDLENBQUM7YUFDTjtTQUNKO1FBQ0QsZ0JBQWdCO1FBQ2hCLEtBQUssSUFBSSxLQUFLLElBQUksTUFBTSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsU0FBUyxDQUFDLE1BQU0sRUFBRTtZQUM1RCxPQUFPLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxXQUFXLEVBQUUsR0FBRyxLQUFLLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDL0QsSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsR0FBRyxLQUFLLENBQUM7WUFDOUIsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsT0FBTzs7Ozs7WUFBRSxVQUFVLEdBQUcsRUFBRSxFQUFFOztvQkFDdEMsT0FBTyxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ3ZELE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDO1lBQ3pDLENBQUMsRUFBQyxDQUFDO1NBQ047UUFFRCxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQzNDLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUNyRCxDQUFDOzs7OztJQUNELGtCQUFrQixDQUFDLElBQUk7UUFDbkI7OztRQUFPOztnQkFDQyxNQUFNLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQztZQUNwRCxPQUFPLE1BQU0sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBQzlDLENBQUMsRUFBQTtJQUNMLENBQUM7Ozs7SUFFRCxTQUFTO1FBQ0wsSUFBSSxJQUFJLENBQUMsV0FBVyxFQUFFOztrQkFDWixPQUFPLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQztZQUNuRCxJQUFJLE9BQU8sRUFBRTtnQkFDVCxPQUFPLENBQUMsa0JBQWtCOzs7O2dCQUFDLENBQUMsTUFBVyxFQUFFLEVBQUU7b0JBQ3ZDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsTUFBTSxDQUFDLFlBQVksQ0FBQztnQkFDM0MsQ0FBQyxFQUFDLENBQUM7YUFDTjtTQUNKO0lBQ0wsQ0FBQzs7Ozs7SUFDTSxXQUFXLENBQUMsT0FBc0I7O2NBQy9CLElBQUksR0FBRyxTQUFTO1FBQ3RCLElBQUksSUFBSSxJQUFJLE9BQU8sRUFBRTs7a0JBQ1gsS0FBSyxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxZQUFZO1lBQ3hDLDBEQUEwRDtZQUMxRCxJQUFJLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsRUFBRTtnQkFDekMsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUM7Z0JBQzlDLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQzthQUNwRDtZQUNELElBQUk7Z0JBQ0EsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQzthQUN6RDtZQUFDLE9BQU8sQ0FBQyxFQUFFO2dCQUNSLE1BQU0sSUFBSSxLQUFLLENBQUMsMkRBQTJELENBQUMsQ0FBQzthQUNoRjtTQUNKO0lBQ0wsQ0FBQzs7OztJQUNNLFlBQVk7UUFDZixJQUFJLENBQUMsR0FBRyxDQUFDLFlBQVksRUFBRSxDQUFDO0lBQzVCLENBQUM7Ozs7O0lBRUQsa0JBQWtCLENBQUMsR0FBRztRQUNsQiw2QkFBNkI7UUFDN0IsT0FBTyxHQUFHLENBQUMsT0FBTyxDQUFDLFdBQVc7Ozs7UUFBRSxVQUFVLEtBQUs7WUFDM0MsT0FBTyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDbEMsQ0FBQyxFQUFDLENBQUM7SUFDUCxDQUFDOzs7O0lBRUQsV0FBVztRQUNQLDREQUE0RDtRQUM1RCxJQUFJLElBQUksQ0FBQyxXQUFXLEtBQUssV0FBVyxJQUFJLFFBQVEsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRTtZQUN0RSxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUM5QyxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDO1lBQzFCLE1BQU0sQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUMsTUFBTSxFQUFFLENBQUM7U0FDeEM7SUFDTCxDQUFDOzs7c0JBeklBLEtBQUs7Ozs7SUFBTixnQ0FDeUI7Ozs7O0lBRXpCLGlDQUF3Qjs7Ozs7SUFDeEIsNEJBQW1COzs7OztJQUNuQixvQ0FBOEI7Ozs7O0lBQzlCLGdDQUF1Qjs7Ozs7SUFDdkIsb0NBQTJCOzs7OztJQUMzQixxQ0FBNEI7Ozs7O0lBQzVCLGdDQUF1Qzs7Ozs7SUFDdkMscUNBQStCOzs7OztJQUMvQix1Q0FBNEI7O0lBQzVCLGlDQUF3Qjs7SUFFa0Qsb0NBQW1DOztJQUFFLDRCQUE2QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEVsZW1lbnRSZWYsIEV2ZW50RW1pdHRlciwgUmVuZGVyZXIsIEl0ZXJhYmxlRGlmZmVycywgRG9DaGVjaywgU2ltcGxlQ2hhbmdlcywgSW5wdXQsIENoYW5nZURldGVjdG9yUmVmLCBLZXlWYWx1ZURpZmZlcnMgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuZGVjbGFyZSB2YXIgalF1ZXJ5OiBhbnk7XG5cbnZhciBOT0RFUyA9IHtcbiAgICBcImlnLXRleHQtZWRpdG9yXCI6IFwiZGl2XCIsXG4gICAgXCJpZy1udW1lcmljLWVkaXRvclwiOiBcImlucHV0XCIsXG4gICAgXCJpZy1wZXJjZW50LWVkaXRvclwiOiBcImlucHV0XCIsXG4gICAgXCJpZy1tYXNrLWVkaXRvclwiOiBcImlucHV0XCIsXG4gICAgXCJpZy1kYXRlLXBpY2tlclwiOiBcImlucHV0XCIsXG4gICAgXCJpZy10aW1lLXBpY2tlclwiOiBcImlucHV0XCIsXG4gICAgXCJpZy1kYXRlLWVkaXRvclwiOiBcImlucHV0XCIsXG4gICAgXCJpZy1jdXJyZW5jeS1lZGl0b3JcIjogXCJpbnB1dFwiLFxuICAgIFwiaWctY2hlY2tib3gtZWRpdG9yXCI6IFwiaW5wdXRcIixcbiAgICBcImlnLWh0bWwtZWRpdG9yXCI6IFwiZGl2XCIsXG4gICAgXCJpZy1jb21ib1wiOiBcImlucHV0XCIsXG4gICAgXCJpZy1ncmlkXCI6IFwidGFibGVcIixcbiAgICBcImlnLXRyZWUtZ3JpZFwiOiBcInRhYmxlXCIsXG4gICAgXCJpZy1oaWVyYXJjaGljYWwtZ3JpZFwiOiBcInRhYmxlXCIsXG4gICAgXCJpZy1waXZvdC1kYXRhLXNlbGVjdG9yXCI6IFwiZGl2XCIsXG4gICAgXCJpZy1waXZvdC1ncmlkXCI6IFwidGFibGVcIixcbiAgICBcImlnLWRhdGEtY2hhcnRcIjogXCJkaXZcIixcbiAgICBcImlnLXBpZS1jaGFydFwiOiBcImRpdlwiLFxuICAgIFwiaWctZG91Z2hudXQtY2hhcnRcIjogXCJkaXZcIixcbiAgICBcImlnLWZ1bm5lbC1jaGFydFwiOiBcImRpdlwiLFxuICAgIFwiaWctcmFkaWFsLWdhdWdlXCI6IFwiZGl2XCIsXG4gICAgXCJpZy1zcGFya2xpbmVcIjogXCJkaXZcIixcbiAgICBcImlnLXpvb21iYXJcIjogXCJkaXZcIixcbiAgICBcImlnLW1hcFwiOiBcImRpdlwiLFxuICAgIFwiaWctYnVsbGV0LWdyYXBoXCI6IFwiZGl2XCIsXG4gICAgXCJpZy1saW5lYXItZ2F1Z2VcIjogXCJkaXZcIixcbiAgICBcImlnLXEtci1jb2RlLWJhcmNvZGVcIjogXCJkaXZcIixcbiAgICBcImlnLXZhbGlkYXRvclwiOiBcImRpdlwiLFxuICAgIFwiaWctdXBsb2FkXCI6IFwiZGl2XCIsXG4gICAgXCJpZy1wb3BvdmVyXCI6IFwiZGl2XCIsXG4gICAgXCJpZy1yYXRpbmdcIjogXCJkaXZcIixcbiAgICBcImlnLXZpZGVvLXBsYXllclwiOiBcImRpdlwiLFxuICAgIFwiaWctcmFkaWFsLW1lbnVcIjogXCJkaXZcIixcbiAgICBcImlnLXNwbGl0LWJ1dHRvblwiOiBcImRpdlwiLFxuICAgIFwiaWctbm90aWZpZXJcIjogXCJkaXZcIixcbiAgICBcImlnLXRyZWVcIjogXCJkaXZcIixcbiAgICBcImlnLWRpYWxvZ1wiOiBcImRpdlwiLFxuICAgIFwiaWctc3BsaXR0ZXJcIjogXCJkaXZcIixcbiAgICBcImlnLWxheW91dC1tYW5hZ2VyXCI6IFwiZGl2XCIsXG4gICAgXCJpZy10aWxlLW1hbmFnZXJcIjogXCJkaXZcIixcbiAgICBcImlnLXNwcmVhZHNoZWV0XCI6IFwiZGl2XCIsXG4gICAgXCJpZy1zY2hlZHVsZXJcIjogXCJkaXZcIlxufTtcblxuZXhwb3J0IGNsYXNzIElnQ29udHJvbEJhc2U8TW9kZWw+IGltcGxlbWVudHMgRG9DaGVjayB7XG4gICAgQElucHV0KClcbiAgICBwdWJsaWMgb3B0aW9uczogYW55ID0ge307XG5cbiAgICBwcm90ZWN0ZWQgX2RpZmZlcnM6IGFueTtcbiAgICBwcm90ZWN0ZWQgX2VsOiBhbnk7XG4gICAgcHJvdGVjdGVkIF93aWRnZXROYW1lOiBzdHJpbmc7XG4gICAgcHJvdGVjdGVkIF9kaWZmZXI6IGFueTtcbiAgICBwcm90ZWN0ZWQgX29wdHNEaWZmZXI6IGFueTtcbiAgICBwcm90ZWN0ZWQgX2t2YWxEaWZmZXJzOiBhbnk7XG4gICAgcHJvdGVjdGVkIF9ldmVudHM6IE1hcDxzdHJpbmcsIHN0cmluZz47XG4gICAgcHJpdmF0ZSBfZXZ0RW1taXRlcnM6IGFueSA9IHt9O1xuICAgIHByaXZhdGUgX25hdGl2ZUVsZW1lbnQ6IGFueTtcbiAgICBwdWJsaWMgd2lkZ2V0SWQ6IHN0cmluZztcblxuICAgIGNvbnN0cnVjdG9yKGVsOiBFbGVtZW50UmVmLCByZW5kZXJlcjogUmVuZGVyZXIsIGRpZmZlcnM6IEl0ZXJhYmxlRGlmZmVycywgcHVibGljIGt2YWxEaWZmZXJzOiBLZXlWYWx1ZURpZmZlcnMsIHB1YmxpYyBjZHI6IENoYW5nZURldGVjdG9yUmVmKSB7XG4gICAgICAgIHRoaXMuX2RpZmZlcnMgPSBkaWZmZXJzO1xuICAgICAgICB0aGlzLl9uYXRpdmVFbGVtZW50ID0gZWwubmF0aXZlRWxlbWVudDtcbiAgICAgICAgdGhpcy5fd2lkZ2V0TmFtZSA9IHRoaXMuY29udmVydFRvQ2FtZWxDYXNlKGVsLm5hdGl2ZUVsZW1lbnQubm9kZU5hbWUudG9Mb3dlckNhc2UoKSk7Ly9pZy1ncmlkIC0+IGlnR3JpZFxuICAgICAgICB0aGlzLl9lbCA9IGVsLm5hdGl2ZUVsZW1lbnQuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudChOT0RFU1tlbC5uYXRpdmVFbGVtZW50Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCldKSk7XG5cbiAgICAgICAgZm9yICh2YXIgcHJvcHQgaW4galF1ZXJ5LnVpW3RoaXMuX3dpZGdldE5hbWVdLnByb3RvdHlwZS5ldmVudHMpIHtcbiAgICAgICAgICAgIHRoaXNbcHJvcHRdID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgICAgICAgICAgLy9jYWhjaW5nIHRoZSBldmVudCBlbW1pdHRlcnMgZm9yIGNhc2VzIHdoZW4gdGhlIGV2ZW50IG5hbWUgaXMgdGhlIHNhbWUgYXMgYSBtZXRob2QgbmFtZS5cbiAgICAgICAgICAgIHRoaXMuX2V2dEVtbWl0ZXJzW3Byb3B0XSA9IHRoaXNbcHJvcHRdO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgY3JlYXRlU2V0dGVyKG5hbWUpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgdGhpcy5vcHRpb25zW25hbWVdID0gdmFsdWU7XG4gICAgICAgICAgICBpZiAodGhpcy5fY29uZmlnKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fY29uZmlnW25hbWVdID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoalF1ZXJ5LnVpW3RoaXMuX3dpZGdldE5hbWVdICYmXG4gICAgICAgICAgICAgICAgalF1ZXJ5LnVpW3RoaXMuX3dpZGdldE5hbWVdLnByb3RvdHlwZS5vcHRpb25zICYmXG4gICAgICAgICAgICAgICAgalF1ZXJ5LnVpW3RoaXMuX3dpZGdldE5hbWVdLnByb3RvdHlwZS5vcHRpb25zLmhhc093blByb3BlcnR5KG5hbWUpICYmXG4gICAgICAgICAgICAgICAgalF1ZXJ5KHRoaXMuX2VsKS5kYXRhKHRoaXMuX3dpZGdldE5hbWUpKSB7XG4gICAgICAgICAgICAgICAgalF1ZXJ5KHRoaXMuX2VsKVt0aGlzLl93aWRnZXROYW1lXShcIm9wdGlvblwiLCBuYW1lLCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgdmFyIGV2dE5hbWU7XG4gICAgICAgIGxldCB0aGF0ID0gdGhpcztcbiAgICAgICAgdGhpcy5fZXZlbnRzID0gbmV3IE1hcDxzdHJpbmcsIHN0cmluZz4oKTtcblxuICAgICAgICBmb3IgKHZhciBvcHQgaW4galF1ZXJ5LnVpW3RoaXMuX3dpZGdldE5hbWVdLnByb3RvdHlwZS5vcHRpb25zKSB7XG4gICAgICAgICAgICAvL2NvcHkgcm9vdCBsZXZlbCBvcHRpb25zIGludG8gdGhpcy5vcHRpb25zXG4gICAgICAgICAgICBpZiAodGhpc1tvcHRdICYmIHR5cGVvZiB0aGlzW29wdF0gIT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgICAgICAgIHRoaXMub3B0aW9uc1tvcHRdID0gdGhpc1tvcHRdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZm9yICh2YXIgb3B0IGluIGpRdWVyeS51aVt0aGlzLl93aWRnZXROYW1lXS5wcm90b3R5cGUub3B0aW9ucykge1xuICAgICAgICAgICAgaWYgKG9wdCAhPT0gXCJkYXRhU291cmNlXCIpIHtcbiAgICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgb3B0LCB7XG4gICAgICAgICAgICAgICAgICAgIHNldDogdGhpcy5jcmVhdGVTZXR0ZXIob3B0KSxcbiAgICAgICAgICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgcHJvcE5hbWVzID0galF1ZXJ5LnVpW3RoaXMuX3dpZGdldE5hbWVdLnByb3RvdHlwZTtcbiAgICAgICAgZm9yICh2YXIgbmFtZSBpbiBwcm9wTmFtZXMpIHtcbiAgICAgICAgICAgIGlmIChuYW1lLmluZGV4T2YoXCJfXCIpICE9PSAwICYmIHR5cGVvZiBqUXVlcnkudWlbdGhpcy5fd2lkZ2V0TmFtZV0ucHJvdG90eXBlW25hbWVdID09PSBcImZ1bmN0aW9uXCJcbiAgICAgICAgICAgICAgICAmJiBuYW1lICE9PSBcImRhdGFTb3VyY2VcIikge1xuICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGF0LCBuYW1lLCB7XG4gICAgICAgICAgICAgICAgICAgIGdldDogdGhhdC5jcmVhdGVNZXRob2RHZXR0ZXIobmFtZSlcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvL2V2ZW50cyBiaW5kaW5nXG4gICAgICAgIGZvciAodmFyIHByb3B0IGluIGpRdWVyeS51aVt0aGlzLl93aWRnZXROYW1lXS5wcm90b3R5cGUuZXZlbnRzKSB7XG4gICAgICAgICAgICBldnROYW1lID0gdGhpcy5fd2lkZ2V0TmFtZS50b0xvd2VyQ2FzZSgpICsgcHJvcHQudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgIHRoaXMuX2V2ZW50c1tldnROYW1lXSA9IHByb3B0O1xuICAgICAgICAgICAgalF1ZXJ5KHRoaXMuX2VsKS5vbihldnROYW1lLCBmdW5jdGlvbiAoZXZ0LCB1aSkge1xuICAgICAgICAgICAgICAgIHZhciBlbW1pdGVyID0gdGhhdC5fZXZ0RW1taXRlcnNbdGhhdC5fZXZlbnRzW2V2dC50eXBlXV07XG4gICAgICAgICAgICAgICAgZW1taXRlci5lbWl0KHsgZXZlbnQ6IGV2dCwgdWk6IHVpIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBqUXVlcnkodGhpcy5fZWwpLmF0dHIoXCJpZFwiLCB0aGlzLndpZGdldElkKTtcbiAgICAgICAgalF1ZXJ5KHRoaXMuX2VsKVt0aGlzLl93aWRnZXROYW1lXSh0aGlzLm9wdGlvbnMpO1xuICAgIH1cbiAgICBjcmVhdGVNZXRob2RHZXR0ZXIobmFtZSkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHdpZGdldCA9IGpRdWVyeSh0aGlzLl9lbCkuZGF0YSh0aGlzLl93aWRnZXROYW1lKTtcbiAgICAgICAgICAgIHJldHVybiBqUXVlcnkucHJveHkod2lkZ2V0W25hbWVdLCB3aWRnZXQpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgbmdEb0NoZWNrKCkge1xuICAgICAgICBpZiAodGhpcy5fb3B0c0RpZmZlcikge1xuICAgICAgICAgICAgY29uc3QgY2hhbmdlcyA9IHRoaXMuX29wdHNEaWZmZXIuZGlmZih0aGlzLm9wdGlvbnMpO1xuICAgICAgICAgICAgaWYgKGNoYW5nZXMpIHtcbiAgICAgICAgICAgICAgICBjaGFuZ2VzLmZvckVhY2hDaGFuZ2VkSXRlbSgoY2hhbmdlOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpc1tjaGFuZ2Uua2V5XSA9IGNoYW5nZS5jdXJyZW50VmFsdWU7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgcHVibGljIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpOiB2b2lkIHtcbiAgICAgICAgY29uc3Qgb3B0cyA9IFwib3B0aW9uc1wiO1xuICAgICAgICBpZiAob3B0cyBpbiBjaGFuZ2VzKSB7XG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGNoYW5nZXNbb3B0c10uY3VycmVudFZhbHVlO1xuICAgICAgICAgICAgLy9vcHRpb25zIGhhdmUgYmVlbiBjaGFuZ2VkLiBEZXN0cm95IGFuZCByZS1jcmVhdGUgd2lkZ2V0LlxuICAgICAgICAgICAgaWYgKGpRdWVyeSh0aGlzLl9lbCkuZGF0YSh0aGlzLl93aWRnZXROYW1lKSkge1xuICAgICAgICAgICAgICAgIGpRdWVyeSh0aGlzLl9lbClbdGhpcy5fd2lkZ2V0TmFtZV0oXCJkZXN0cm95XCIpO1xuICAgICAgICAgICAgICAgIGpRdWVyeSh0aGlzLl9lbClbdGhpcy5fd2lkZ2V0TmFtZV0odGhpcy5vcHRpb25zKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fb3B0c0RpZmZlciA9IHRoaXMua3ZhbERpZmZlcnMuZmluZCh7fSkuY3JlYXRlKCk7XG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiT25seSBiaW5kaW5nIHRvIG9iamVjdCBpcyBzdXBwb3J0ZWQgZm9yIG9wdGlvbnMgcHJvcGVydHkuXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHB1YmxpYyBtYXJrRm9yQ2hlY2soKSB7XG4gICAgICAgIHRoaXMuY2RyLm1hcmtGb3JDaGVjaygpO1xuICAgIH1cblxuICAgIGNvbnZlcnRUb0NhbWVsQ2FzZShzdHIpIHtcbiAgICAgICAgLy9jb252ZXJ0IGh5cGhlbiB0byBjYW1lbENhc2VcbiAgICAgICAgcmV0dXJuIHN0ci5yZXBsYWNlKC8tKFthLXpdKS9nLCBmdW5jdGlvbiAoZ3JvdXApIHtcbiAgICAgICAgICAgIHJldHVybiBncm91cFsxXS50b1VwcGVyQ2FzZSgpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBuZ09uRGVzdHJveSgpIHtcbiAgICAgICAgLy8gaWdab29tYmFyIHNob3VsZCBiZSBhdHRhY2hlZCB0byBib2R5IHdoZW4gYmVpbmcgZGVzdHJveWVkXG4gICAgICAgIGlmICh0aGlzLl93aWRnZXROYW1lICE9PSBcImlnWm9vbWJhclwiIHx8IGRvY3VtZW50LmJvZHkuY29udGFpbnModGhpcy5fZWwpKSB7XG4gICAgICAgICAgICBqUXVlcnkodGhpcy5fZWwpW3RoaXMuX3dpZGdldE5hbWVdKFwiZGVzdHJveVwiKTtcbiAgICAgICAgICAgIGpRdWVyeSh0aGlzLl9lbCkucmVtb3ZlKCk7XG4gICAgICAgICAgICBqUXVlcnkodGhpcy5fbmF0aXZlRWxlbWVudCkucmVtb3ZlKCk7XG4gICAgICAgIH1cbiAgICB9XG59Il19