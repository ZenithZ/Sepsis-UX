/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { EventEmitter, Input } from '@angular/core';
/** @type {?} */
var NODES = {
    "ig-text-editor": "div",
    "ig-numeric-editor": "input",
    "ig-percent-editor": "input",
    "ig-mask-editor": "input",
    "ig-date-picker": "input",
    "ig-time-picker": "input",
    "ig-date-editor": "input",
    "ig-currency-editor": "input",
    "ig-checkbox-editor": "input",
    "ig-html-editor": "div",
    "ig-combo": "input",
    "ig-grid": "table",
    "ig-tree-grid": "table",
    "ig-hierarchical-grid": "table",
    "ig-pivot-data-selector": "div",
    "ig-pivot-grid": "table",
    "ig-data-chart": "div",
    "ig-pie-chart": "div",
    "ig-doughnut-chart": "div",
    "ig-funnel-chart": "div",
    "ig-radial-gauge": "div",
    "ig-sparkline": "div",
    "ig-zoombar": "div",
    "ig-map": "div",
    "ig-bullet-graph": "div",
    "ig-linear-gauge": "div",
    "ig-q-r-code-barcode": "div",
    "ig-validator": "div",
    "ig-upload": "div",
    "ig-popover": "div",
    "ig-rating": "div",
    "ig-video-player": "div",
    "ig-radial-menu": "div",
    "ig-split-button": "div",
    "ig-notifier": "div",
    "ig-tree": "div",
    "ig-dialog": "div",
    "ig-splitter": "div",
    "ig-layout-manager": "div",
    "ig-tile-manager": "div",
    "ig-spreadsheet": "div",
    "ig-scheduler": "div"
};
/**
 * @template Model
 */
var IgControlBase = /** @class */ (function () {
    function IgControlBase(el, renderer, differs, kvalDiffers, cdr) {
        this.kvalDiffers = kvalDiffers;
        this.cdr = cdr;
        this.options = {};
        this._evtEmmiters = {};
        this._differs = differs;
        this._nativeElement = el.nativeElement;
        this._widgetName = this.convertToCamelCase(el.nativeElement.nodeName.toLowerCase()); //ig-grid -> igGrid
        this._el = el.nativeElement.appendChild(document.createElement(NODES[el.nativeElement.nodeName.toLowerCase()]));
        for (var propt in jQuery.ui[this._widgetName].prototype.events) {
            this[propt] = new EventEmitter();
            //cahcing the event emmitters for cases when the event name is the same as a method name.
            this._evtEmmiters[propt] = this[propt];
        }
    }
    /**
     * @param {?} name
     * @return {?}
     */
    IgControlBase.prototype.createSetter = /**
     * @param {?} name
     * @return {?}
     */
    function (name) {
        return (/**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this.options[name] = value;
            if (this._config) {
                this._config[name] = value;
            }
            if (jQuery.ui[this._widgetName] &&
                jQuery.ui[this._widgetName].prototype.options &&
                jQuery.ui[this._widgetName].prototype.options.hasOwnProperty(name) &&
                jQuery(this._el).data(this._widgetName)) {
                jQuery(this._el)[this._widgetName]("option", name, value);
            }
        });
    };
    /**
     * @return {?}
     */
    IgControlBase.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var evtName;
        /** @type {?} */
        var that = this;
        this._events = new Map();
        for (var opt in jQuery.ui[this._widgetName].prototype.options) {
            //copy root level options into this.options
            if (this[opt] && typeof this[opt] !== "function") {
                this.options[opt] = this[opt];
            }
        }
        for (var opt in jQuery.ui[this._widgetName].prototype.options) {
            if (opt !== "dataSource") {
                Object.defineProperty(this, opt, {
                    set: this.createSetter(opt),
                    enumerable: true,
                    configurable: true
                });
            }
        }
        /** @type {?} */
        var propNames = jQuery.ui[this._widgetName].prototype;
        for (var name in propNames) {
            if (name.indexOf("_") !== 0 && typeof jQuery.ui[this._widgetName].prototype[name] === "function"
                && name !== "dataSource") {
                Object.defineProperty(that, name, {
                    get: that.createMethodGetter(name)
                });
            }
        }
        //events binding
        for (var propt in jQuery.ui[this._widgetName].prototype.events) {
            evtName = this._widgetName.toLowerCase() + propt.toLowerCase();
            this._events[evtName] = propt;
            jQuery(this._el).on(evtName, (/**
             * @param {?} evt
             * @param {?} ui
             * @return {?}
             */
            function (evt, ui) {
                /** @type {?} */
                var emmiter = that._evtEmmiters[that._events[evt.type]];
                emmiter.emit({ event: evt, ui: ui });
            }));
        }
        jQuery(this._el).attr("id", this.widgetId);
        jQuery(this._el)[this._widgetName](this.options);
    };
    /**
     * @param {?} name
     * @return {?}
     */
    IgControlBase.prototype.createMethodGetter = /**
     * @param {?} name
     * @return {?}
     */
    function (name) {
        return (/**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var widget = jQuery(this._el).data(this._widgetName);
            return jQuery.proxy(widget[name], widget);
        });
    };
    /**
     * @return {?}
     */
    IgControlBase.prototype.ngDoCheck = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (this._optsDiffer) {
            /** @type {?} */
            var changes = this._optsDiffer.diff(this.options);
            if (changes) {
                changes.forEachChangedItem((/**
                 * @param {?} change
                 * @return {?}
                 */
                function (change) {
                    _this[change.key] = change.currentValue;
                }));
            }
        }
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    IgControlBase.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        /** @type {?} */
        var opts = "options";
        if (opts in changes) {
            /** @type {?} */
            var value = changes[opts].currentValue;
            //options have been changed. Destroy and re-create widget.
            if (jQuery(this._el).data(this._widgetName)) {
                jQuery(this._el)[this._widgetName]("destroy");
                jQuery(this._el)[this._widgetName](this.options);
            }
            try {
                this._optsDiffer = this.kvalDiffers.find({}).create();
            }
            catch (e) {
                throw new Error("Only binding to object is supported for options property.");
            }
        }
    };
    /**
     * @return {?}
     */
    IgControlBase.prototype.markForCheck = /**
     * @return {?}
     */
    function () {
        this.cdr.markForCheck();
    };
    /**
     * @param {?} str
     * @return {?}
     */
    IgControlBase.prototype.convertToCamelCase = /**
     * @param {?} str
     * @return {?}
     */
    function (str) {
        //convert hyphen to camelCase
        return str.replace(/-([a-z])/g, (/**
         * @param {?} group
         * @return {?}
         */
        function (group) {
            return group[1].toUpperCase();
        }));
    };
    /**
     * @return {?}
     */
    IgControlBase.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        // igZoombar should be attached to body when being destroyed
        if (this._widgetName !== "igZoombar" || document.body.contains(this._el)) {
            jQuery(this._el)[this._widgetName]("destroy");
            jQuery(this._el).remove();
            jQuery(this._nativeElement).remove();
        }
    };
    IgControlBase.propDecorators = {
        options: [{ type: Input }]
    };
    return IgControlBase;
}());
export { IgControlBase };
if (false) {
    /** @type {?} */
    IgControlBase.prototype.options;
    /**
     * @type {?}
     * @protected
     */
    IgControlBase.prototype._differs;
    /**
     * @type {?}
     * @protected
     */
    IgControlBase.prototype._el;
    /**
     * @type {?}
     * @protected
     */
    IgControlBase.prototype._widgetName;
    /**
     * @type {?}
     * @protected
     */
    IgControlBase.prototype._differ;
    /**
     * @type {?}
     * @protected
     */
    IgControlBase.prototype._optsDiffer;
    /**
     * @type {?}
     * @protected
     */
    IgControlBase.prototype._kvalDiffers;
    /**
     * @type {?}
     * @protected
     */
    IgControlBase.prototype._events;
    /**
     * @type {?}
     * @private
     */
    IgControlBase.prototype._evtEmmiters;
    /**
     * @type {?}
     * @private
     */
    IgControlBase.prototype._nativeElement;
    /** @type {?} */
    IgControlBase.prototype.widgetId;
    /** @type {?} */
    IgControlBase.prototype.kvalDiffers;
    /** @type {?} */
    IgControlBase.prototype.cdr;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaWdjb250cm9sYmFzZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2lnbml0ZXVpLWFuZ3VsYXItd3JhcHBlcnMvIiwic291cmNlcyI6WyJsaWIvaWdjb250cm9sYmFzZS9pZ2NvbnRyb2xiYXNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQWMsWUFBWSxFQUFxRCxLQUFLLEVBQXNDLE1BQU0sZUFBZSxDQUFDOztJQUluSixLQUFLLEdBQUc7SUFDUixnQkFBZ0IsRUFBRSxLQUFLO0lBQ3ZCLG1CQUFtQixFQUFFLE9BQU87SUFDNUIsbUJBQW1CLEVBQUUsT0FBTztJQUM1QixnQkFBZ0IsRUFBRSxPQUFPO0lBQ3pCLGdCQUFnQixFQUFFLE9BQU87SUFDekIsZ0JBQWdCLEVBQUUsT0FBTztJQUN6QixnQkFBZ0IsRUFBRSxPQUFPO0lBQ3pCLG9CQUFvQixFQUFFLE9BQU87SUFDN0Isb0JBQW9CLEVBQUUsT0FBTztJQUM3QixnQkFBZ0IsRUFBRSxLQUFLO0lBQ3ZCLFVBQVUsRUFBRSxPQUFPO0lBQ25CLFNBQVMsRUFBRSxPQUFPO0lBQ2xCLGNBQWMsRUFBRSxPQUFPO0lBQ3ZCLHNCQUFzQixFQUFFLE9BQU87SUFDL0Isd0JBQXdCLEVBQUUsS0FBSztJQUMvQixlQUFlLEVBQUUsT0FBTztJQUN4QixlQUFlLEVBQUUsS0FBSztJQUN0QixjQUFjLEVBQUUsS0FBSztJQUNyQixtQkFBbUIsRUFBRSxLQUFLO0lBQzFCLGlCQUFpQixFQUFFLEtBQUs7SUFDeEIsaUJBQWlCLEVBQUUsS0FBSztJQUN4QixjQUFjLEVBQUUsS0FBSztJQUNyQixZQUFZLEVBQUUsS0FBSztJQUNuQixRQUFRLEVBQUUsS0FBSztJQUNmLGlCQUFpQixFQUFFLEtBQUs7SUFDeEIsaUJBQWlCLEVBQUUsS0FBSztJQUN4QixxQkFBcUIsRUFBRSxLQUFLO0lBQzVCLGNBQWMsRUFBRSxLQUFLO0lBQ3JCLFdBQVcsRUFBRSxLQUFLO0lBQ2xCLFlBQVksRUFBRSxLQUFLO0lBQ25C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SUFBSSxDQUFDLEdBQUcsQ0FBQyxZQUFZLEVBQUUsQ0FBQztJQUM1QixDQUFDOzs7OztJQUVELDBDQUFrQjs7OztJQUFsQixVQUFtQixHQUFHO1FBQ2xCLDZCQUE2QjtRQUM3QixPQUFPLEdBQUcsQ0FBQyxPQUFPLENBQUMsV0FBVzs7OztRQUFFLFVBQVUsS0FBSztZQUMzQyxPQUFPLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUNsQyxDQUFDLEVBQUMsQ0FBQztJQUNQLENBQUM7Ozs7SUFFRCxtQ0FBVzs7O0lBQVg7UUFDSSw0REFBNEQ7UUFDNUQsSUFBSSxJQUFJLENBQUMsV0FBVyxLQUFLLFdBQVcsSUFBSSxRQUFRLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUU7WUFDdEUsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUM7WUFDOUMsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQztZQUMxQixNQUFNLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDO1NBQ3hDO0lBQ0wsQ0FBQzs7MEJBeklBLEtBQUs7O0lBMElWLG9CQUFDO0NBQUEsQUEzSUQsSUEySUM7U0EzSVksYUFBYTs7O0lBQ3RCLGdDQUN5Qjs7Ozs7SUFFekIsaUNBQXdCOzs7OztJQUN4Qiw0QkFBbUI7Ozs7O0lBQ25CLG9DQUE4Qjs7Ozs7SUFDOUIsZ0NBQXVCOzs7OztJQUN2QixvQ0FBMkI7Ozs7O0lBQzNCLHFDQUE0Qjs7Ozs7SUFDNUIsZ0NBQXVDOzs7OztJQUN2QyxxQ0FBK0I7Ozs7O0lBQy9CLHVDQUE0Qjs7SUFDNUIsaUNBQXdCOztJQUVrRCxvQ0FBbUM7O0lBQUUsNEJBQTZCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRWxlbWVudFJlZiwgRXZlbnRFbWl0dGVyLCBSZW5kZXJlciwgSXRlcmFibGVEaWZmZXJzLCBEb0NoZWNrLCBTaW1wbGVDaGFuZ2VzLCBJbnB1dCwgQ2hhbmdlRGV0ZWN0b3JSZWYsIEtleVZhbHVlRGlmZmVycyB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5kZWNsYXJlIHZhciBqUXVlcnk6IGFueTtcblxudmFyIE5PREVTID0ge1xuICAgIFwiaWctdGV4dC1lZGl0b3JcIjogXCJkaXZcIixcbiAgICBcImlnLW51bWVyaWMtZWRpdG9yXCI6IFwiaW5wdXRcIixcbiAgICBcImlnLXBlcmNlbnQtZWRpdG9yXCI6IFwiaW5wdXRcIixcbiAgICBcImlnLW1hc2stZWRpdG9yXCI6IFwiaW5wdXRcIixcbiAgICBcImlnLWRhdGUtcGlja2VyXCI6IFwiaW5wdXRcIixcbiAgICBcImlnLXRpbWUtcGlja2VyXCI6IFwiaW5wdXRcIixcbiAgICBcImlnLWRhdGUtZWRpdG9yXCI6IFwiaW5wdXRcIixcbiAgICBcImlnLWN1cnJlbmN5LWVkaXRvclwiOiBcImlucHV0XCIsXG4gICAgXCJpZy1jaGVja2JveC1lZGl0b3JcIjogXCJpbnB1dFwiLFxuICAgIFwiaWctaHRtbC1lZGl0b3JcIjogXCJkaXZcIixcbiAgICBcImlnLWNvbWJvXCI6IFwiaW5wdXRcIixcbiAgICBcImlnLWdyaWRcIjogXCJ0YWJsZVwiLFxuICAgIFwiaWctdHJlZS1ncmlkXCI6IFwidGFibGVcIixcbiAgICBcImlnLWhpZXJhcmNoaWNhbC1ncmlkXCI6IFwidGFibGVcIixcbiAgICBcImlnLXBpdm90LWRhdGEtc2VsZWN0b3JcIjogXCJkaXZcIixcbiAgICBcImlnLXBpdm90LWdyaWRcIjogXCJ0YWJsZVwiLFxuICAgIFwiaWctZGF0YS1jaGFydFwiOiBcImRpdlwiLFxuICAgIFwiaWctcGllLWNoYXJ0XCI6IFwiZGl2XCIsXG4gICAgXCJpZy1kb3VnaG51dC1jaGFydFwiOiBcImRpdlwiLFxuICAgIFwiaWctZnVubmVsLWNoYXJ0XCI6IFwiZGl2XCIsXG4gICAgXCJpZy1yYWRpYWwtZ2F1Z2VcIjogXCJkaXZcIixcbiAgICBcImlnLXNwYXJrbGluZVwiOiBcImRpdlwiLFxuICAgIFwiaWctem9vbWJhclwiOiBcImRpdlwiLFxuICAgIFwiaWctbWFwXCI6IFwiZGl2XCIsXG4gICAgXCJpZy1idWxsZXQtZ3JhcGhcIjogXCJkaXZcIixcbiAgICBcImlnLWxpbmVhci1nYXVnZVwiOiBcImRpdlwiLFxuICAgIFwiaWctcS1yLWNvZGUtYmFyY29kZVwiOiBcImRpdlwiLFxuICAgIFwiaWctdmFsaWRhdG9yXCI6IFwiZGl2XCIsXG4gICAgXCJpZy11cGxvYWRcIjogXCJkaXZcIixcbiAgICBcImlnLXBvcG92ZXJcIjogXCJkaXZcIixcbiAgICBcImlnLXJhdGluZ1wiOiBcImRpdlwiLFxuICAgIFwiaWctdmlkZW8tcGxheWVyXCI6IFwiZGl2XCIsXG4gICAgXCJpZy1yYWRpYWwtbWVudVwiOiBcImRpdlwiLFxuICAgIFwiaWctc3BsaXQtYnV0dG9uXCI6IFwiZGl2XCIsXG4gICAgXCJpZy1ub3RpZmllclwiOiBcImRpdlwiLFxuICAgIFwiaWctdHJlZVwiOiBcImRpdlwiLFxuICAgIFwiaWctZGlhbG9nXCI6IFwiZGl2XCIsXG4gICAgXCJpZy1zcGxpdHRlclwiOiBcImRpdlwiLFxuICAgIFwiaWctbGF5b3V0LW1hbmFnZXJcIjogXCJkaXZcIixcbiAgICBcImlnLXRpbGUtbWFuYWdlclwiOiBcImRpdlwiLFxuICAgIFwiaWctc3ByZWFkc2hlZXRcIjogXCJkaXZcIixcbiAgICBcImlnLXNjaGVkdWxlclwiOiBcImRpdlwiXG59O1xuXG5leHBvcnQgY2xhc3MgSWdDb250cm9sQmFzZTxNb2RlbD4gaW1wbGVtZW50cyBEb0NoZWNrIHtcbiAgICBASW5wdXQoKVxuICAgIHB1YmxpYyBvcHRpb25zOiBhbnkgPSB7fTtcblxuICAgIHByb3RlY3RlZCBfZGlmZmVyczogYW55O1xuICAgIHByb3RlY3RlZCBfZWw6IGFueTtcbiAgICBwcm90ZWN0ZWQgX3dpZGdldE5hbWU6IHN0cmluZztcbiAgICBwcm90ZWN0ZWQgX2RpZmZlcjogYW55O1xuICAgIHByb3RlY3RlZCBfb3B0c0RpZmZlcjogYW55O1xuICAgIHByb3RlY3RlZCBfa3ZhbERpZmZlcnM6IGFueTtcbiAgICBwcm90ZWN0ZWQgX2V2ZW50czogTWFwPHN0cmluZywgc3RyaW5nPjtcbiAgICBwcml2YXRlIF9ldnRFbW1pdGVyczogYW55ID0ge307XG4gICAgcHJpdmF0ZSBfbmF0aXZlRWxlbWVudDogYW55O1xuICAgIHB1YmxpYyB3aWRnZXRJZDogc3RyaW5nO1xuXG4gICAgY29uc3RydWN0b3IoZWw6IEVsZW1lbnRSZWYsIHJlbmRlcmVyOiBSZW5kZXJlciwgZGlmZmVyczogSXRlcmFibGVEaWZmZXJzLCBwdWJsaWMga3ZhbERpZmZlcnM6IEtleVZhbHVlRGlmZmVycywgcHVibGljIGNkcjogQ2hhbmdlRGV0ZWN0b3JSZWYpIHtcbiAgICAgICAgdGhpcy5fZGlmZmVycyA9IGRpZmZlcnM7XG4gICAgICAgIHRoaXMuX25hdGl2ZUVsZW1lbnQgPSBlbC5uYXRpdmVFbGVtZW50O1xuICAgICAgICB0aGlzLl93aWRnZXROYW1lID0gdGhpcy5jb252ZXJ0VG9DYW1lbENhc2UoZWwubmF0aXZlRWxlbWVudC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpKTsvL2lnLWdyaWQgLT4gaWdHcmlkXG4gICAgICAgIHRoaXMuX2VsID0gZWwubmF0aXZlRWxlbWVudC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KE5PREVTW2VsLm5hdGl2ZUVsZW1lbnQubm9kZU5hbWUudG9Mb3dlckNhc2UoKV0pKTtcblxuICAgICAgICBmb3IgKHZhciBwcm9wdCBpbiBqUXVlcnkudWlbdGhpcy5fd2lkZ2V0TmFtZV0ucHJvdG90eXBlLmV2ZW50cykge1xuICAgICAgICAgICAgdGhpc1twcm9wdF0gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgICAgICAvL2NhaGNpbmcgdGhlIGV2ZW50IGVtbWl0dGVycyBmb3IgY2FzZXMgd2hlbiB0aGUgZXZlbnQgbmFtZSBpcyB0aGUgc2FtZSBhcyBhIG1ldGhvZCBuYW1lLlxuICAgICAgICAgICAgdGhpcy5fZXZ0RW1taXRlcnNbcHJvcHRdID0gdGhpc1twcm9wdF07XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjcmVhdGVTZXR0ZXIobmFtZSkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLm9wdGlvbnNbbmFtZV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIGlmICh0aGlzLl9jb25maWcpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9jb25maWdbbmFtZV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChqUXVlcnkudWlbdGhpcy5fd2lkZ2V0TmFtZV0gJiZcbiAgICAgICAgICAgICAgICBqUXVlcnkudWlbdGhpcy5fd2lkZ2V0TmFtZV0ucHJvdG90eXBlLm9wdGlvbnMgJiZcbiAgICAgICAgICAgICAgICBqUXVlcnkudWlbdGhpcy5fd2lkZ2V0TmFtZV0ucHJvdG90eXBlLm9wdGlvbnMuaGFzT3duUHJvcGVydHkobmFtZSkgJiZcbiAgICAgICAgICAgICAgICBqUXVlcnkodGhpcy5fZWwpLmRhdGEodGhpcy5fd2lkZ2V0TmFtZSkpIHtcbiAgICAgICAgICAgICAgICBqUXVlcnkodGhpcy5fZWwpW3RoaXMuX3dpZGdldE5hbWVdKFwib3B0aW9uXCIsIG5hbWUsIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIG5nT25Jbml0KCkge1xuICAgICAgICB2YXIgZXZ0TmFtZTtcbiAgICAgICAgbGV0IHRoYXQgPSB0aGlzO1xuICAgICAgICB0aGlzLl9ldmVudHMgPSBuZXcgTWFwPHN0cmluZywgc3RyaW5nPigpO1xuXG4gICAgICAgIGZvciAodmFyIG9wdCBpbiBqUXVlcnkudWlbdGhpcy5fd2lkZ2V0TmFtZV0ucHJvdG90eXBlLm9wdGlvbnMpIHtcbiAgICAgICAgICAgIC8vY29weSByb290IGxldmVsIG9wdGlvbnMgaW50byB0aGlzLm9wdGlvbnNcbiAgICAgICAgICAgIGlmICh0aGlzW29wdF0gJiYgdHlwZW9mIHRoaXNbb3B0XSAhPT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zW29wdF0gPSB0aGlzW29wdF07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBmb3IgKHZhciBvcHQgaW4galF1ZXJ5LnVpW3RoaXMuX3dpZGdldE5hbWVdLnByb3RvdHlwZS5vcHRpb25zKSB7XG4gICAgICAgICAgICBpZiAob3B0ICE9PSBcImRhdGFTb3VyY2VcIikge1xuICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBvcHQsIHtcbiAgICAgICAgICAgICAgICAgICAgc2V0OiB0aGlzLmNyZWF0ZVNldHRlcihvcHQpLFxuICAgICAgICAgICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBwcm9wTmFtZXMgPSBqUXVlcnkudWlbdGhpcy5fd2lkZ2V0TmFtZV0ucHJvdG90eXBlO1xuICAgICAgICBmb3IgKHZhciBuYW1lIGluIHByb3BOYW1lcykge1xuICAgICAgICAgICAgaWYgKG5hbWUuaW5kZXhPZihcIl9cIikgIT09IDAgJiYgdHlwZW9mIGpRdWVyeS51aVt0aGlzLl93aWRnZXROYW1lXS5wcm90b3R5cGVbbmFtZV0gPT09IFwiZnVuY3Rpb25cIlxuICAgICAgICAgICAgICAgICYmIG5hbWUgIT09IFwiZGF0YVNvdXJjZVwiKSB7XG4gICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoYXQsIG5hbWUsIHtcbiAgICAgICAgICAgICAgICAgICAgZ2V0OiB0aGF0LmNyZWF0ZU1ldGhvZEdldHRlcihuYW1lKVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vZXZlbnRzIGJpbmRpbmdcbiAgICAgICAgZm9yICh2YXIgcHJvcHQgaW4galF1ZXJ5LnVpW3RoaXMuX3dpZGdldE5hbWVdLnByb3RvdHlwZS5ldmVudHMpIHtcbiAgICAgICAgICAgIGV2dE5hbWUgPSB0aGlzLl93aWRnZXROYW1lLnRvTG93ZXJDYXNlKCkgKyBwcm9wdC50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgdGhpcy5fZXZlbnRzW2V2dE5hbWVdID0gcHJvcHQ7XG4gICAgICAgICAgICBqUXVlcnkodGhpcy5fZWwpLm9uKGV2dE5hbWUsIGZ1bmN0aW9uIChldnQsIHVpKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVtbWl0ZXIgPSB0aGF0Ll9ldnRFbW1pdGVyc1t0aGF0Ll9ldmVudHNbZXZ0LnR5cGVdXTtcbiAgICAgICAgICAgICAgICBlbW1pdGVyLmVtaXQoeyBldmVudDogZXZ0LCB1aTogdWkgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGpRdWVyeSh0aGlzLl9lbCkuYXR0cihcImlkXCIsIHRoaXMud2lkZ2V0SWQpO1xuICAgICAgICBqUXVlcnkodGhpcy5fZWwpW3RoaXMuX3dpZGdldE5hbWVdKHRoaXMub3B0aW9ucyk7XG4gICAgfVxuICAgIGNyZWF0ZU1ldGhvZEdldHRlcihuYW1lKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgd2lkZ2V0ID0galF1ZXJ5KHRoaXMuX2VsKS5kYXRhKHRoaXMuX3dpZGdldE5hbWUpO1xuICAgICAgICAgICAgcmV0dXJuIGpRdWVyeS5wcm94eSh3aWRnZXRbbmFtZV0sIHdpZGdldCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBuZ0RvQ2hlY2soKSB7XG4gICAgICAgIGlmICh0aGlzLl9vcHRzRGlmZmVyKSB7XG4gICAgICAgICAgICBjb25zdCBjaGFuZ2VzID0gdGhpcy5fb3B0c0RpZmZlci5kaWZmKHRoaXMub3B0aW9ucyk7XG4gICAgICAgICAgICBpZiAoY2hhbmdlcykge1xuICAgICAgICAgICAgICAgIGNoYW5nZXMuZm9yRWFjaENoYW5nZWRJdGVtKChjaGFuZ2U6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzW2NoYW5nZS5rZXldID0gY2hhbmdlLmN1cnJlbnRWYWx1ZTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBwdWJsaWMgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xuICAgICAgICBjb25zdCBvcHRzID0gXCJvcHRpb25zXCI7XG4gICAgICAgIGlmIChvcHRzIGluIGNoYW5nZXMpIHtcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gY2hhbmdlc1tvcHRzXS5jdXJyZW50VmFsdWU7XG4gICAgICAgICAgICAvL29wdGlvbnMgaGF2ZSBiZWVuIGNoYW5nZWQuIERlc3Ryb3kgYW5kIHJlLWNyZWF0ZSB3aWRnZXQuXG4gICAgICAgICAgICBpZiAoalF1ZXJ5KHRoaXMuX2VsKS5kYXRhKHRoaXMuX3dpZGdldE5hbWUpKSB7XG4gICAgICAgICAgICAgICAgalF1ZXJ5KHRoaXMuX2VsKVt0aGlzLl93aWRnZXROYW1lXShcImRlc3Ryb3lcIik7XG4gICAgICAgICAgICAgICAgalF1ZXJ5KHRoaXMuX2VsKVt0aGlzLl93aWRnZXROYW1lXSh0aGlzLm9wdGlvbnMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICB0aGlzLl9vcHRzRGlmZmVyID0gdGhpcy5rdmFsRGlmZmVycy5maW5kKHt9KS5jcmVhdGUoKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJPbmx5IGJpbmRpbmcgdG8gb2JqZWN0IGlzIHN1cHBvcnRlZCBmb3Igb3B0aW9ucyBwcm9wZXJ0eS5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgcHVibGljIG1hcmtGb3JDaGVjaygpIHtcbiAgICAgICAgdGhpcy5jZHIubWFya0ZvckNoZWNrKCk7XG4gICAgfVxuXG4gICAgY29udmVydFRvQ2FtZWxDYXNlKHN0cikge1xuICAgICAgICAvL2NvbnZlcnQgaHlwaGVuIHRvIGNhbWVsQ2FzZVxuICAgICAgICByZXR1cm4gc3RyLnJlcGxhY2UoLy0oW2Etel0pL2csIGZ1bmN0aW9uIChncm91cCkge1xuICAgICAgICAgICAgcmV0dXJuIGdyb3VwWzFdLnRvVXBwZXJDYXNlKCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIG5nT25EZXN0cm95KCkge1xuICAgICAgICAvLyBpZ1pvb21iYXIgc2hvdWxkIGJlIGF0dGFjaGVkIHRvIGJvZHkgd2hlbiBiZWluZyBkZXN0cm95ZWRcbiAgICAgICAgaWYgKHRoaXMuX3dpZGdldE5hbWUgIT09IFwiaWdab29tYmFyXCIgfHwgZG9jdW1lbnQuYm9keS5jb250YWlucyh0aGlzLl9lbCkpIHtcbiAgICAgICAgICAgIGpRdWVyeSh0aGlzLl9lbClbdGhpcy5fd2lkZ2V0TmFtZV0oXCJkZXN0cm95XCIpO1xuICAgICAgICAgICAgalF1ZXJ5KHRoaXMuX2VsKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIGpRdWVyeSh0aGlzLl9uYXRpdmVFbGVtZW50KS5yZW1vdmUoKTtcbiAgICAgICAgfVxuICAgIH1cbn0iXX0=